<?xml version="1.0" encoding="UTF-8"?>
<local:BasePage xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" x:Class="PaketGlobal.PackageDetailsPage"
                xmlns:local="clr-namespace:PaketGlobal" xmlns:zxing="clr-namespace:ZXing.Net.Mobile.Forms;assembly=ZXing.Net.Mobile.Forms"
                xmlns:xlabs="clr-namespace:XLabs.Forms.Controls;assembly=XLabs.Forms">
    <local:BasePage.Resources>
        <ResourceDictionary>
            <local:DeliveryStatusToStringConverter x:Key="deliveryStatusToStringConverter" />
            <local:DeliveryStatusToRefundVisibilityConverter x:Key="deliveryStatusToRefundVisibilityConverter" />
            <local:RefundStatusToReclaimVisibilityConverter x:Key="refundStatusToReclaimVisibilityConverter" />
            <local:PaketRoleToStringConverter x:Key="paketRoleToStringConverter" />
        </ResourceDictionary>
    </local:BasePage.Resources>
    <local:BasePage.Content>
        <TableView x:Name="contentPackage" HasUnevenRows="true" RowHeight="-1">
            <TableRoot>
                <TableSection Title="Information">
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Role" FontSize="13" TextColor="#808080"/>
                            <Label Text = "{Binding MyRole, Converter={StaticResource paketRoleToStringConverter}, Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                        </StackLayout>
                    </ViewCell>
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Status" FontSize="13" TextColor="#808080"/>
                            <Label x:Name="lblStatus" Text = "{Binding DeliveryStatus, Converter={StaticResource deliveryStatusToStringConverter}, Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                            <StackLayout x:Name="stackReclaim" IsVisible="{Binding DeliveryStatusPrivate, Converter={StaticResource refundStatusToReclaimVisibilityConverter}, Mode=OneWay}">
                                <Label Text = "Package is delivered. You can reclaim unspent funds from the escrow." FontSize="13" TextColor="#7acd6a"/>
                                <xlabs:ExtendedButton x:Name="btnReclaim" Margin="0,20,0,0" Text="Reclaim" HorizontalOptions="Center" TextColor="#ffffff" BackgroundColor="#7acd6a" Clicked="ReclaimClicked"/>
                            </StackLayout>
                        </StackLayout>
                    </ViewCell>
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Deadline" FontSize="13" TextColor="#808080"/>
                            <Label Text = "{Binding DeadlineDT, StringFormat='{0:MM.dd.yyyy}', Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                            <StackLayout x:Name="stackRefund" IsVisible="{Binding DeliveryStatusPrivate, Converter={StaticResource deliveryStatusToRefundVisibilityConverter}, Mode=OneWay}">
                                <Label Text = "Deadline Expired. You can refund from the escrow." FontSize="13" TextColor="#F44336"/>
                                <xlabs:ExtendedButton x:Name="btnRefund" Margin="0,20,0,0" Text="Refund" HorizontalOptions="Center" TextColor="#ffffff" BackgroundColor="#F44336" Clicked="RefundClicked"/>
                            </StackLayout>
                        </StackLayout>
                    </ViewCell>
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Launched" FontSize="13" TextColor="#808080"/>
                            <Label Text = "{Binding SendTimeDT, StringFormat='{0:MM.dd.yyyy h:mm tt}', Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                        </StackLayout>
                    </ViewCell>
                </TableSection>
                <TableSection Title="Funds">
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Collateral" FontSize="13" TextColor="#808080"/>
                            <Label Text = "{Binding FormattedCollateral, Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                        </StackLayout>
                    </ViewCell>
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                            <Label Text = "Payment" FontSize="13" TextColor="#808080"/>
                            <Label Text = "{Binding FormattedPayment, Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                        </StackLayout>
                    </ViewCell>
                </TableSection>
                <TableSection Title="Payment Info">
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="5">
                            <Label Text = "Use this barcode to pass the paket to a courier or accept it by the recepient" LineBreakMode="WordWrap" FontSize="13" TextColor="#808080"/>
                            <zxing:ZXingBarcodeImageView x:Name="barcodeImage" HorizontalOptions="FillAndExpand" HeightRequest="320"/>
                        </StackLayout>
                    </ViewCell>
                </TableSection>
                <TableSection Title="Events">
                    <ViewCell>
                        <StackLayout Orientation="Vertical" Spacing="0">
<!--                            <Label Text = "Events" FontSize="13" TextColor="#808080"/>-->
                            <ListView x:Name="eventsList" RowHeight="100" AbsoluteLayout.LayoutFlags="All" AbsoluteLayout.LayoutBounds="0, 0, 1.0, 1.0"
                                    ItemsSource="{Binding Events}" ItemSelected="EventItemSelected" IsPullToRefreshEnabled="false">
                                  <ListView.ItemTemplate>
                                     <DataTemplate>
                                        <ViewCell>
                                            <StackLayout Orientation="Vertical" Padding="15,8,15,5" Spacing="0">
                                                <Label Text="{Binding EventType, Mode=OneWay}" FontSize="17" TextColor="#000000"/>
                                                <Label Text="{Binding PaketUser, Mode=OneWay}" FontSize="13" TextColor="#808080"/>
                                                <Label Text="{Binding TimestampDT, StringFormat='{0:MM.dd.yyyy h:mm tt}', Mode=OneWay}" FontSize="13" TextColor="#808080"/>
                                                <Label Text="{Binding GPSString, StringFormat='Location: {0}', StringFormat='Sent: {0}' Mode=OneWay}" FontSize="13" TextColor="#808080"/>
                                            </StackLayout>
                                         </ViewCell>                    
                                    </DataTemplate>
                                 </ListView.ItemTemplate>
                            </ListView>
                        </StackLayout>
                    </ViewCell>
                </TableSection>
            </TableRoot>
        </TableView>
    </local:BasePage.Content>
</local:BasePage>
