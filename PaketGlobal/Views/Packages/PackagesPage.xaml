<?xml version="1.0" encoding="UTF-8"?>
<local:BasePage
    NavigationPage.HasNavigationBar="False"
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" x:Class="PaketGlobal.PackagesPage"
    xmlns:local="clr-namespace:PaketGlobal"
    xmlns:Views="clr-namespace:XF.Controls.Views"
    xmlns:xfg="clr-namespace:XFGloss;assembly=XFGloss">
    <xfg:ContentPageGloss.BackgroundGradient>
        <xfg:Gradient Rotation="300">
            <xfg:GradientStep StepColor="#858fb4" StepPercentage="0" />
            <xfg:GradientStep StepColor="#2f3248" StepPercentage="1" />
        </xfg:Gradient>
    </xfg:ContentPageGloss.BackgroundGradient>
    <local:BasePage.Content>
        <RelativeLayout>
            <Label x:Name="TitleLabel" TextColor="White" Text="{local:Translate MyPackages}" XAlign="Center" FontFamily="{StaticResource SemiBoldFont}" FontSize="16"
                   RelativeLayout.YConstraint="30"
                   RelativeLayout.XConstraint="0"
                   RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
                   Opacity="0"/>
            <StackLayout x:Name="RightButtons" Opacity="0" Spacing="15" HorizontalOptions="EndAndExpand" Orientation="Horizontal"
                    RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.95}"
                    RelativeLayout.YConstraint="18">
                <Button Clicked="AcceptPackageClicked" WidthRequest="30" BackgroundColor="Transparent" Image="qr_code_small.png" HorizontalOptions="Start"/>
                <Button Clicked="LaunchPackageClicked" WidthRequest="30" BackgroundColor="Transparent" Image="add_icon_small.png" HorizontalOptions="StartAndExpand"/>
            </StackLayout>
            <StackLayout BackgroundColor="Transparent" x:Name="HeaderView" Spacing="20" Padding="27,40,20,30" RelativeLayout.XConstraint="0" RelativeLayout.YConstraint="10"
                          RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
                <StackLayout Orientation="Horizontal" BackgroundColor="Transparent" Padding="0">
                    <StackLayout Spacing="0" BackgroundColor="Transparent" Orientation="Horizontal" HorizontalOptions="Start">
                        <Label x:Name="MyPackagesTitleLabel" Text="{local:Translate MyPackages}" FontFamily="{StaticResource SemiBoldFont}" FontSize="24" TextColor="White" 
                               HorizontalOptions="StartAndExpand"
                               VerticalOptions="Center"/>
                    </StackLayout>
                    <StackLayout Spacing="15" BackgroundColor="Transparent" Orientation="Horizontal" HorizontalOptions="EndAndExpand">
                        <Button Clicked="AcceptPackageClicked" WidthRequest="50" BackgroundColor="Transparent" Image="qr_code.png" HorizontalOptions="Start" VerticalOptions="Center" />
                        <Button Clicked="LaunchPackageClicked" WidthRequest="50" BackgroundColor="Transparent" Image="add.png" HorizontalOptions="StartAndExpand" VerticalOptions="Center" />
                     </StackLayout>
                </StackLayout>
                <Label x:Name="MyPackagesSubTitleLabel" Text="{local:Translate MyPackagesInfo}" FontFamily="{StaticResource MediumFont}" FontSize="14" TextColor="#CDCDCD"/>
                <Image Source="search_icon.png" HorizontalOptions="Start"/>
            </StackLayout>
            <Views:ListView x:Name="PakagesView" BackgroundColor="#F0F0F0" 
                      ItemsSource="{Binding PackagesList}" 
                      ItemSelected="PackageItemSelected"
                      IsPullToRefreshEnabled="true"
                      Scrolled="OnListViewScrolled"
                      SeparatorVisibility="None" RowHeight="150" VerticalOptions="FillAndExpand"
                      HorizontalOptions="FillAndExpand"
                      RelativeLayout.XConstraint = "0"
                      RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1, Constant=-210}"
                      RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
                      RelativeLayout.YConstraint = "{ConstraintExpression Type=RelativeToView, ElementName=HeaderView, Property=Y, Factor=1, Constant=200}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <local:CellWithoutSelection>
                            <RelativeLayout>
                                <StackLayout Orientation="Vertical" 
                                 Padding="10,10,10,10"  BackgroundColor="Transparent"
                                 HeightRequest="130"
                                  RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
                                    <local:PaketFrameWithShadow BackgroundColor="White" HorizontalOptions="Fill" VerticalOptions="Fill" HeightRequest="130"
                                 CornerRadius="15"/>
                                </StackLayout>
                                <StackLayout Spacing="15" Orientation="Horizontal" RelativeLayout.XConstraint="30" RelativeLayout.YConstraint="30">
                                     <Image Source="{Binding StatusIcon, Mode=OneWay}" HorizontalOptions="Center" VerticalOptions="Center"/>
                                     <Label Text="{Binding FullFormattedStatus, Mode=OneWay}" FontFamily="{StaticResource SemiBoldFont}" FontSize="15" TextColor="Black"
                                       HorizontalOptions="Center" VerticalOptions="Center"/>
                                </StackLayout>
                                <local:PaketProgress Progress="{Binding Progress, Mode=OneWay}" 
                                             RelativeLayout.XConstraint="37" 
                                             RelativeLayout.YConstraint="77"
                                             RelativeLayout.HeightConstraint="1"
                                             RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.81}"/>
                                <Image Source="point_0.png" HorizontalOptions="Start"
                                       RelativeLayout.XConstraint="33" RelativeLayout.YConstraint="71"/>
                                <Image Source="{Binding ProgressIcon, Mode=OneWay}" HorizontalOptions="Start"
                                       RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.88}"
                                       RelativeLayout.YConstraint="71"/>
                                <StackLayout Orientation="Horizontal" RelativeLayout.XConstraint="35" RelativeLayout.YConstraint="95"
                                             RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.82}">
                                    <StackLayout Spacing="0" HorizontalOptions="StartAndExpand">
                                        <Label Text="{local:Translate Sent}" FontFamily="{StaticResource SemiBoldFont}" FontSize="10" TextColor="#787878"/>
                                        <Label Text="{Binding SendTimeString, Mode=OneWay}" FontFamily="{StaticResource SemiBoldFont}" FontSize="12" TextColor="Black"/>
                                    </StackLayout>
                                    <StackLayout Spacing="0" HorizontalOptions="EndAndExpand">
                                        <Label Text="{local:Translate Deadline}" FontFamily="{StaticResource SemiBoldFont}" FontSize="10" TextColor="#787878" XAlign="End"/>
                                        <Label Text="{Binding DeadlineString, Mode=OneWay}" FontFamily="{StaticResource SemiBoldFont}" FontSize="12" TextColor="Black" XAlign="End"/>
                                    </StackLayout>
                                </StackLayout>
                            </RelativeLayout>
                        </local:CellWithoutSelection>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </Views:ListView >
            <Label x:Name="PlacholderLabel" IsVisible="false" IsEnabled="false"
                Text = "No Packages Found"
                      XAlign="Center" YAlign="Center"
                      VerticalOptions="FillAndExpand"
                      HorizontalOptions="FillAndExpand"
                      TextColor="#D3D3D3" FontSize = "20"
                      RelativeLayout.HeightConstraint="30"
                      RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
                      RelativeLayout.YConstraint = "{ConstraintExpression Type=RelativeToView, ElementName=HeaderView, Property=Y, Factor=1, Constant=400}"/>
            <ActivityIndicator x:Name="ActivityIndicator" IsVisible="true" IsRunning="true"
                      VerticalOptions="CenterAndExpand"
                      Color="#606686"
                      HorizontalOptions="CenterAndExpand" RelativeLayout.HeightConstraint="40" RelativeLayout.WidthConstraint="40"
                      RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width,Factor=0.5,Constant=-20}"
                      RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height,Factor=0.5,Constant=80}"/>
        </RelativeLayout>
    </local:BasePage.Content>
</local:BasePage>
